<!DOCTYPE html>
<html lang="uz">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Mahsulotlar - TechHouse</title>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
    <link rel="stylesheet" href="css/style.css">
</head>

<body>

    <nav class="navbar navbar-expand-lg navbar-pro sticky-top border-bottom">
        <div class="container">
            <a class="navbar-brand fw-bold" href="index.html">
                TechHouse<span class="brand-dot">.</span>
            </a>

            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navMain">
                <span class="navbar-toggler-icon"></span>
            </button>

            <div class="collapse navbar-collapse" id="navMain">
                <ul class="navbar-nav me-auto mb-2 mb-lg-0 gap-lg-2">
                    <li class="nav-item"><a class="nav-link" href="index.html">Bosh menu</a></li>
                    <li class="nav-item"><a class="nav-link" href="products.html">Kategoriyalar</a></li>
                    <li class="nav-item"><a class="nav-link" href="about.html">About us</a></li>
                </ul>

                <div class="d-flex align-items-center gap-2">
                    <div class="nav-search-wrap">
                        <i class="bi bi-search"></i>
                        <input id="navSearch" class="form-control form-control-sm nav-search" placeholder="Qidirish..."
                            aria-label="Qidirish">
                    </div>
                    <a href="cart.html" class="btn btn-outline-secondary btn-sm icon-btn position-relative"
                        aria-label="Cart">
                        <i class="bi bi-cart3"></i>
                        <span id="cartCount"
                            class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-danger">
                            0
                        </span>
                    </a>

                    <a href="login.html" class="btn btn-primary btn-sm">Login</a>

                    <a href="register.html" class="btn btn-outline-secondary btn-sm icon-btn" aria-label="Register">
                        <i class="bi bi-person"></i>
                    </a>
                </div>
            </div>
        </div>
    </nav>
    <section class="section">
        <div class="container">
            <div class="d-flex flex-wrap align-items-center justify-content-between gap-2">
                <div>
                    <h2 class="mb-1">Mahsulotlar</h2>
                    <div class="small-muted">Qidirish, kategoriya va saralash mavjud</div>
                </div>
                <div class="pill-like small-muted" id="foundText"></div>
            </div>
            <div class="row g-2 mt-3">
                <div class="col-12 col-md-5">
                    <input id="searchInput" class="form-control" placeholder="Mahsulot nomi bo'yicha qidirish...">
                </div>

                <div class="col-12 col-md-3">
                    <select id="catSelect" class="form-select"></select>
                </div>

                <div class="col-12 col-md-4">
                    <select id="sortSelect" class="form-select">
                        <option value="default">Saralash (default)</option>
                        <option value="priceAsc">Narx: arzon ‚Üí qimmat</option>
                        <option value="priceDesc">Narx: qimmat ‚Üí arzon</option>
                        <option value="nameAsc">Nomi: A ‚Üí Z</option>
                        <option value="nameDesc">Nomi: Z ‚Üí A</option>
                    </select>
                </div>
            </div>
        </div>
    </section>
    <section class="pb-4">
        <div class="container">
            <div class="row g-3" id="productList"></div>
        </div>
    </section>
    <footer class="footer-dark py-4 mt-5">
        <div class="container">
            <div class="row g-3">
                <div class="col-12 col-md-4">
                    <div class="footer-title">TechHouse</div>
                    <div>Maishiy texnika va aqlli uy qurilmalari do'koni.</div>
                    <div class="mt-2">Ish vaqti: Du - Sh 09:00 - 21:00</div>
                </div>

                <div class="col-12 col-md-4">
                    <div class="footer-title">Kontakt</div>
                    <div>üìû +998 97 552 40 50</div>
                    <div>üìç Toshkent, Sergeli</div>
                    <div>‚úâÔ∏è info@techhouse.uz</div>
                </div>

                <div class="col-12 col-md-4">
                    <div class="footer-title">Foydali havolalar</div>
                    <div><a href="#">Maxfiylik siyosati</a></div>
                    <div><a href="#">Foydalanish shartlari</a></div>
                    <div class="mt-2">
                        <a href="#">Instagram</a> ¬∑
                        <a href="#">Telegram</a> ¬∑
                        <a href="#">LinkedIn</a>
                    </div>
                </div>
            </div>

            <div class="footer-bottom mt-3">
                ¬© 2026 TechHouse. Barcha huquqlar himoyalangan.
            </div>
        </div>
    </footer>
    <script src="js/data.js"></script>
    <script src="js/cart.js"></script>
    <script src="js/navbar.js"></script>

    <script>
        const list = document.getElementById("productList");
        const search = document.getElementById("searchInput");
        const cat = document.getElementById("catSelect");
        const sortSelect = document.getElementById("sortSelect");
        const foundText = document.getElementById("foundText");

        function updateBadge() {
            const badge = document.getElementById("cartCount");
            if (badge) badge.textContent = Cart.cartCount();
        }
        const params = new URLSearchParams(location.search);
        const urlCat = params.get("cat");
        const urlSearch = params.get("search");
        const allOpt = document.createElement("option");
        allOpt.value = "Barchasi";
        allOpt.textContent = "Barchasi";
        cat.appendChild(allOpt);

        CATEGORIES.forEach(c => {
            const o = document.createElement("option");
            o.value = c;
            o.textContent = c;
            cat.appendChild(o);
        });

        if (urlCat) cat.value = urlCat;
        if (urlSearch) search.value = urlSearch;

        function render() {
            list.innerHTML = "";

            const s = search.value.trim().toLowerCase();
            const c = cat.value;

            let items = PRODUCTS.filter(p => {
                const okCat = (c === "Barchasi" || p.category === c);
                const okSearch = (p.name.toLowerCase().includes(s) || p.category.toLowerCase().includes(s));
                return okCat && okSearch;
            });

            const sort = sortSelect.value;
            if (sort === "priceAsc") items.sort((a, b) => a.price - b.price);
            if (sort === "priceDesc") items.sort((a, b) => b.price - a.price);
            if (sort === "nameAsc") items.sort((a, b) => a.name.localeCompare(b.name));
            if (sort === "nameDesc") items.sort((a, b) => b.name.localeCompare(a.name));

            foundText.textContent = "Topildi: " + items.length + " ta";

            if (items.length === 0) {
                list.innerHTML = `<div class="col-12"><div class="alert alert-secondary">Mahsulot topilmadi</div></div>`;
                return;
            }

            items.forEach(p => {
                const hasSale = p.oldPrice && p.oldPrice > p.price;

                list.innerHTML += `
        <div class="col-12 col-sm-6 col-lg-3">
          <div class="card card-clean p-2 h-100">
            <img class="product-img mb-2" src="${p.img}" alt="${p.name}">
            <div class="fw-semibold">${p.name}</div>
            <div class="small-muted">${p.category} ‚Ä¢ Mavjud: ${p.stock}</div>

            <div class="mt-1">
              <div class="fw-bold">${formatSum(p.price)} so'm</div>
              ${hasSale ? `<div class="small-muted"><del>${formatSum(p.oldPrice)} so‚Äòm</del> <span class="text-danger">Aksiya</span></div>` : ``}
            </div>

            <div class="d-flex gap-2 mt-auto pt-2">
              <button class="btn btn-sm btn-primary w-100"
                onclick="Cart.addToCart(${p.id}); updateBadge();">
                Savatga
              </button>
              <a class="btn btn-sm btn-outline-secondary" href="product.html?id=${p.id}" aria-label="Detail">
                <i class="bi bi-info-circle"></i>
              </a>
            </div>
          </div>
        </div>`;
            });
        }

        search.addEventListener("input", render);
        cat.addEventListener("change", render);
        sortSelect.addEventListener("change", render);

        render();
        updateBadge();
    </script>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>

</html>